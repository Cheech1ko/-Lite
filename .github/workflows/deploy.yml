name: Deploy to GitHub Pages

on:
  push:
    branches: [ master ]  
  pull_request:
    branches: [ master ]  
  workflow_dispatch:  # ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ‚ÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # ĞĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ Ğ´Ğ»Ñ Ğ¿ÑƒĞ±Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ½Ğ° gh-pages
      
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
        
    - name: ğŸ“¦ Install dependencies
      run: |
        cd frontend
        npm ci --silent
        
    - name: ğŸ” Run ESLint
      run: |
        cd frontend
        npm run lint || echo "ESLint Ğ½Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½"
        
    - name: ğŸ—ï¸ Build application
      run: |
        cd frontend
        npm run build
        
    - name: ğŸ“Š Size check
      run: |
        cd frontend
        du -sh build/
        echo "Ğ Ğ°Ğ·Ğ¼ĞµÑ€ ÑĞ±Ğ¾Ñ€ĞºĞ¸:"
        find build/ -type f -name "*.js" -exec du -h {} \; | sort -hr | head -5
        
    - name: ğŸš€ Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./frontend/build
        user_name: 'github-actions[bot]'
        user_email: 'github-actions[bot]@users.noreply.github.com'
        commit_message: 'Deploy: ${{ github.sha }}'
        
    - name: ğŸ“ Update deployment status
      run: |
        echo "ğŸ‰ Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½!"
        echo "Ğ¡Ğ°Ğ¹Ñ‚ Ğ±ÑƒĞ´ĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ¿Ğ¾ Ğ°Ğ´Ñ€ĞµÑÑƒ:"
        echo "https://cheech1ko.github.io/-Lite/"